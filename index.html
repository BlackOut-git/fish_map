<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>낚시 정보 서비스</title>
	<link rel="stylesheet" href="./src/style.css">
	<script src="src/jquery-3.6.1.min.js"></script>
</head>
<body>
    <header id="header">
		<div id="logo">
				<img src="./src/logo.png" width ="800px" height ="200px"></img>
		</div>
		<table class="top_menu">
			<tr>
				<td onmouseover="this.style.backgroundColor='#87CEEB'" onmouseout="this.style.backgroundColor=''">
					<a href="index.html">메인화면</a></td>
				<td onmouseover="this.style.backgroundColor='#87CEEB'" onmouseout="this.style.backgroundColor=''">
					<a href="fish.html">어장정보</a></td>
				<td onmouseover="this.style.backgroundColor='#87CEEB'" onmouseout="this.style.backgroundColor=''">
					<a href="link.html">종합정보</a></td>
			</tr>
		</table>
	</header>		
	<div id="map"></div>
	<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=af6aa8f37383bb772256753421dfd821"></script>
	<script>
		var mapContainer = document.getElementById('map'),
			mapOption = { 
				center: new kakao.maps.LatLng(36, 127.5),
				level: 12
			};

		var map = new kakao.maps.Map(mapContainer, mapOption);
		var key = "27B577B6-88AE-464D-B558-55D33057EFB2"
		var mmList = [{
			mmaf: 101,
			mmsi: `994401597,994401579,994401583,994401584`
		},{
			mmaf: 102,
			mmsi: `994401001,994401040,994401000`
		},{
			mmaf: 103,
			mmsi: `994403110`
		},{
			mmaf: 104,
			mmsi: `1000520,1000507`
		},{
			mmaf: 105,
			mmsi: `4422880`
		},{
			mmaf: 109,
			mmsi: `994401623,994401606,2091003,2095081`
		},{
			mmaf: 110,
			mmsi: `994403579`
		},{
			mmaf: 113,
			mmsi: `440103006`
		}
		]

		for (var i = 0; i < mmList.length; i++){
			$.ajax({
				url: "http://marineweather.nmpnt.go.kr:8001/openWeatherNow.do?serviceKey="+key+"&resultType=json&mmaf="+mmList[i].mmaf+"&mmsi="+mmList[i].mmsi,
				dataType: "json"
			}).done(function(data){
				for(var j = 0; j < data.result.recordset.length; j++){
					var positions = {
							latlng: new kakao.maps.LatLng(data.result.recordset[j].LATITUDE, data.result.recordset[j].LONGITUDE),
							iwContent:`
								<div class="wrap">
									<div class="info">
										<div class="title">
											${data.result.recordset[j].MMSI_NM}
										</div>
										<div class="body">
											<div class="desc">
												<div class="ellipsis">
													수온 ${data.result.recordset[j].WATER_TEMPER}℃
												</div>
												<div class="jibun ellipsis">
													${data.result.recordset[j].DATETIME}
												</div>
												<div><a href="https://www.kakaocorp.com/main" target="_blank" class="link">지도열기</a></div>
											</div>
										</div>
									</div>
								</div>
							`}

					var marker = new kakao.maps.Marker({
						map: map,
						position: positions.latlng
					});

					var infowindow = new kakao.maps.InfoWindow({
							content: positions.iwContent 
						});

					kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
					kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
				}

				function makeOverListener(map, marker, infowindow) {
					return function() {
						infowindow.open(map, marker);
					};
				}

				function makeOutListener(infowindow) {
					return function() {
						infowindow.close();
					};
				}
			});
		}
	</script>
</body>
</html>